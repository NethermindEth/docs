"use strict";(self.webpackChunknethermind_docs=self.webpackChunknethermind_docs||[]).push([[9184],{4326:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"developers/plugins/samples/json-rpc-handler","title":"JSON-RPC handler","description":"In this guide we\'re going to create a plugin that adds a new JSON-RPC method to Nethermind and handles all the requests with that method.","source":"@site/versioned_docs/version-1.32.0/developers/plugins/samples/json-rpc-handler.md","sourceDirName":"developers/plugins/samples","slug":"/developers/plugins/samples/json-rpc-handler","permalink":"/1.32.0/developers/plugins/samples/json-rpc-handler","draft":false,"unlisted":false,"editUrl":"https://github.com/NethermindEth/docs/tree/main/versioned_docs/version-1.32.0/developers/plugins/samples/json-rpc-handler.md","tags":[],"version":"1.32.0","lastUpdatedAt":1758827923000,"sidebarPosition":0,"frontMatter":{"title":"JSON-RPC handler","sidebar_position":0},"sidebar":"tutorialSidebar","previous":{"title":"Plugins","permalink":"/1.32.0/developers/plugins/"},"next":{"title":"Troubleshooting","permalink":"/1.32.0/troubleshooting"}}');var i=t(4848),o=t(8453);const r={title:"JSON-RPC handler",sidebar_position:0},d=void 0,l={},a=[];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In this guide we're going to create a plugin that adds a new JSON-RPC method to Nethermind and handles all the requests with that method."}),"\n",(0,i.jsx)(n.admonition,{title:"Before you begin",type:"info",children:(0,i.jsxs)(n.p,{children:["This guide assumes you have read the ",(0,i.jsx)(n.a,{href:"/1.32.0/developers/plugins/",children:"introduction"})," to plugins."]})}),"\n",(0,i.jsxs)(n.p,{children:["In Nethermind, JSON-RPC functionality is an extensible combination of various modules grouped by their responsibilities. For instance, the ",(0,i.jsx)(n.code,{children:"eth_"}),"-prefixed methods, well known by all RPC users, are handled by the ",(0,i.jsx)(n.code,{children:"IEthRpcModule"}),". By design, RPC modules must have their respective interface derived from the ",(0,i.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.JsonRpc/Modules/IRpcModule.cs",children:(0,i.jsx)(n.code,{children:"IRpcModule"})})," and a class implementing that interface."]}),"\n",(0,i.jsxs)(n.p,{children:["Let's create our ",(0,i.jsx)(n.code,{children:"IDemoRpcModule"})," interface and implement it in ",(0,i.jsx)(n.code,{children:"DemoRpcModule"})," class:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="IDemoRpcModule.cs" showLineNumbers',children:'using Nethermind.JsonRpc;\nusing Nethermind.JsonRpc.Modules;\n\nnamespace DemoRpcPlugin;\n\n//highlight-start\n[RpcModule("Demo")]\n//highlight-end\npublic interface IDemoRpcModule : IRpcModule\n{\n    ResultWrapper<string> demo_divide(int x, int y);\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Although the interface above is straightforward, it needs some explanation. Since the ",(0,i.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.JsonRpc/Modules/IRpcModule.cs",children:(0,i.jsx)(n.code,{children:"IRpcModule"})})," is an empty interface, there's nothing specific to implement besides our RPC methods. Each RPC method is a regular interface method with the same name in the code. So, if we want to have ",(0,i.jsx)(n.code,{children:"demo_divide"})," RPC method, we declare a method (function) named the same. If we need to pass parameters with our RPC call, we define those parameters as function arguments with their respective types. In this example, we create a method that takes two integer parameters, ",(0,i.jsx)(n.code,{children:"x"})," (dividend) and ",(0,i.jsx)(n.code,{children:"y"})," (divisor), divides one to another, and returns their quotient, as a string. All RPC methods' return type is ",(0,i.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.JsonRpc/ResultWrapper.cs",children:(0,i.jsx)(n.code,{children:"ResultWrapper<T>"})}),", where the ",(0,i.jsx)(n.code,{children:"T"})," is the actual data type we intend to return in the response. If a method is async, the return type must be ",(0,i.jsx)(n.code,{children:"Task<ResultWrapper<T>>"}),". We will showcase that in later examples. Last but not least, in line 6, the interface is decorated with ",(0,i.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.JsonRpc/Modules/RpcModuleAttribute.cs",children:(0,i.jsx)(n.code,{children:"RpcModule"})})," attribute that sets the name of our module used in configuration settings. We will see its importance later when we try to make a request."]}),"\n",(0,i.jsx)(n.p,{children:"Now, let's begin with the actual implementation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="DemoRpcModule.cs" showLineNumbers',children:'using Nethermind.JsonRpc;\n\nnamespace DemoRpcPlugin;\n\npublic class DemoRpcModule : IDemoRpcModule\n{\n    public ResultWrapper<string> demo_divide(int x, int y)\n    {\n        if (y == 0)\n//highlight-start\n            return ResultWrapper<string>.Fail("Divisor cannot be zero", float.NaN.ToString());\n//highlight-end\n\n        var result = (float)x / y;\n\n//highlight-start\n        return ResultWrapper<string>.Success(result.ToString());\n//highlight-end\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.JsonRpc/ResultWrapper.cs",children:(0,i.jsx)(n.code,{children:"ResultWrapper<T>"})})," provides two statuses -- success and failure. We use the latter when the divisor is zero to show a meaningful error message to the user and some data if needed, ",(0,i.jsx)(n.code,{children:"NaN"})," in our case."]}),"\n",(0,i.jsxs)(n.p,{children:["Now when we have all we need, we should let Nethermind know about our RPC module by registering it with ",(0,i.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.JsonRpc/Modules/IRpcModuleProvider.cs",children:(0,i.jsx)(n.code,{children:"IRpcModuleProvider"})})," in the dedicated ",(0,i.jsx)(n.code,{children:"InitRpcModules()"})," method as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="DemoRpcPlugin.cs" showLineNumbers',children:'using Nethermind.Api;\nusing Nethermind.Api.Extensions;\nusing Nethermind.JsonRpc.Modules;\n\nnamespace DemoRpcPlugin;\n\npublic class DemoRpcPlugin : INethermindPlugin\n{\n    private INethermindApi? _api;\n\n    public string Name => "Demo JSON-RPC plugin";\n    public string Description => "A sample plugin for demo";\n    public string Author => "Anonymous";\n\n    public Task Init(INethermindApi nethermindApi)\n    {\n        _api = nethermindApi;\n\n        return Task.CompletedTask;\n    }\n\n    public Task InitNetworkProtocol() => Task.CompletedTask;\n\n// highlight-start\n    public Task InitRpcModules()\n    {\n        _api?.RpcModuleProvider?.RegisterSingle<IDemoRpcModule>(new DemoRpcModule());\n\n        return Task.CompletedTask;\n    }\n// highlight-end\n\n    public void InitTxTypesAndRlpDecoders(INethermindApi api) { }\n    public ValueTask DisposeAsync() => default;\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Although the highlighted code is mainly self-explanatory, there's a caveat. The ",(0,i.jsx)(n.code,{children:"RegisterSingle<T>()"})," method expects the ",(0,i.jsx)(n.code,{children:"T"})," to be an interface, not a class. The following snippet demonstrates that:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"// Error: Module factory type should be an interface...\n_api.RpcModuleProvider.RegisterSingle(new DemoRpcModule());\n\n// Error: Module factory type should be an interface...\nvar module = new DemoRpcModule();\n_api.RpcModuleProvider.RegisterSingle(module);\n\n// OK\nIDemoRpcModule module = new DemoRpcModule();\n_api.RpcModuleProvider.RegisterSingle(module);\n\n// OK\nvar module = new DemoRpcModule();\n_api.RpcModuleProvider.RegisterSingle((IDemoRpcModule)module);\n// or\n_api.RpcModuleProvider.RegisterSingle<IDemoRpcModule>(module);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We're ready to test our plugin with Nethermind. Let's build it, copy it to the ",(0,i.jsx)(n.code,{children:"plugins"})," folder, and launch Nethermind. It takes a few moments for Nethermind to initialize and start the JSON-RPC server. Once you see the following message, you can start making requests:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"======================== Nethermind initialization completed ========================\n...\nJSON RPC     : http://127.0.0.1:8545 ; http://127.0.0.1:8551\n...\n=====================================================================================\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now let's check how our ",(0,i.jsx)(n.code,{children:"demo_divide"})," method divides 32 by 2 as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl localhost:8545 \\\n  -X POST \\\n  -H "Content-Type: application/json" \\\n  --data \'{\n      "jsonrpc": "2.0",\n      "id": 0,\n      "method": "demo_divide",\n      "params": [\n        32, 2\n      ]\n    }\'\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Nethermind also allows numeric parameters to be passed as strings and supports hex encoding."})}),"\n",(0,i.jsx)(n.p,{children:"The response should look like the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "error": {\n    "code": -32600,\n    "message": "The method \'demo_divide\' is found but the namespace \'Demo\' is disabled for http://127.0.0.1:8545. Consider adding the namespace \'Demo\' to JsonRpc.AdditionalRpcUrls for an additional URL, or to JsonRpc.EnabledModules for the default URL."\n  },\n  "id": 0\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This is because not all RPC modules are enabled by default for security and performance reasons. The bundled Nethermind configurations enable some widely used ones for convenience, but any additional modules, including third-party ones, must be enabled explicitly. We'll follow the instructions in the error message to enable our module for the default RPC URL. Remember the ",(0,i.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.JsonRpc/Modules/RpcModuleAttribute.cs",children:(0,i.jsx)(n.code,{children:"RpcModule"})})," attribute in line 6 of ",(0,i.jsx)(n.code,{children:"IDemoRpcModule"})," interface? Now, it comes in handy. We will use its name of ",(0,i.jsx)(n.code,{children:"Demo"})," to pass it to ",(0,i.jsx)(n.a,{href:"/1.32.0/fundamentals/configuration#jsonrpc-enabledmodules",children:(0,i.jsx)(n.code,{children:"JsonRpc.EnabledModules"})})," as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nethermind \\\n  -c holesky \\\n  --jsonrpc-enabledmodules eth,demo\n"})}),"\n",(0,i.jsx)(n.p,{children:"We enabled just two modules for demo purposes, but you may enable as many as needed. Note that the module names are case-insensitive here."}),"\n",(0,i.jsx)(n.p,{children:"Now, our method should work as expected by returning 16 as a result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "result": "16",\n  "id": 0\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"If we try to divide 32 by 0, the response should be an error like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "error": {\n    "code": -32603,\n    "message": "Divisor cannot be zero",\n    "data": "NaN"\n  },\n  "id": 0\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"That's it. We added our custom JSON-RPC handler to Nethermind."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"To be continued"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>d});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);