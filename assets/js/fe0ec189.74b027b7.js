"use strict";(self.webpackChunknethermind_docs=self.webpackChunknethermind_docs||[]).push([[6336],{7721:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"developers/plugins","title":"Plugins","description":"Nethermind plugins are a powerful way of extending its capabilities by adding new features and functionalities. If you need a functionality missing in Nethermind, you can add it yourself as a plugin! Actually, many Nethermind features are implemented as plugins, like L2 network support such as Optimism and Taiko, health checks, and Shutter, to name a few. The sky is the limit. Almost.","source":"@site/docs/developers/plugins.md","sourceDirName":"developers","slug":"/developers/plugins","permalink":"/next/developers/plugins","draft":false,"unlisted":false,"editUrl":"https://github.com/NethermindEth/docs/tree/main/docs/developers/plugins.md","tags":[],"version":"current","lastUpdatedAt":1738009573000,"sidebarPosition":1,"frontMatter":{"title":"Plugins","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Building from source","permalink":"/next/developers/building-from-source"},"next":{"title":"Troubleshooting","permalink":"/next/troubleshooting"}}');var s=i(4848),r=i(8453);const o={title:"Plugins",sidebar_position:1},a=void 0,l={},h=[{value:"Writing a basic plugin",id:"writing-a-basic-plugin",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Debugging",id:"debugging",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Nethermind plugins are a powerful way of extending its capabilities by adding new features and functionalities. If you need a functionality missing in Nethermind, you can add it yourself as a plugin! Actually, many Nethermind features are implemented as plugins, like L2 network support such as Optimism and Taiko, health checks, and Shutter, to name a few. The sky is the limit. Almost."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Nethermind plugins are .NET assemblies (.dll) that Nethermind's process loads on startup. By default, they are located in the ",(0,s.jsx)(n.code,{children:"plugins"})," directory. To set a different location for plugins, use the ",(0,s.jsx)(n.a,{href:"/next/fundamentals/configuration#plugins-dir",children:(0,s.jsx)(n.code,{children:"--plugins-dir"})})," command line option. In that case, move the bundled plugins to the new location to ensure the correct functionality of Nethermind."]})}),"\n",(0,s.jsx)(n.p,{children:"This guide will walk you through writing a simple plugin to better understand the Nethermind plugin API and its capabilities."}),"\n",(0,s.jsx)(n.h2,{id:"writing-a-basic-plugin",children:"Writing a basic plugin"}),"\n",(0,s.jsx)(n.admonition,{title:"Before you begin",type:"info",children:(0,s.jsxs)(n.p,{children:["Ensure you have installed the required version of the .NET SDK. See ",(0,s.jsx)(n.a,{href:"/next/developers/building-from-source#prerequisites",children:"Building from source"})," for the details."]})}),"\n",(0,s.jsx)(n.p,{children:"To write a Nethermind plugin, you need the Nethermind API to be available to your code. There are two ways of achieving that:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Using the ",(0,s.jsx)(n.a,{href:"https://www.nuget.org/packages/Nethermind.ReferenceAssemblies",children:"Nethermind.ReferenceAssemblies"})," NuGet package. This package is updated with each Nethermind release and is versioned the same. Thus, when choosing this approach, ensure the package version is lower than or equal to your target Nethermind version."]}),"\n",(0,s.jsx)(n.li,{children:"Checking out the Nethermind source code and reference the required projects from the plugin. While this approach seems better for debugging your code, some setups had assembly version mismatch issues after upgrading Nethermind."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"In this guide, we will use the first approach. So, let's pick a working directory for the plugin and create a library project as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dotnet new classlib -n DemoPlugin -o .\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now, we need to add the NuGet package to get access to the Nethermind API:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dotnet add package Nethermind.ReferenceAssemblies\n"})}),"\n",(0,s.jsxs)(n.p,{children:["As the package name implies, it provides ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/standard/assembly/reference-assemblies",children:"reference assemblies"})," that are only enough to compile the project. To see the plugin in action, put the library assembly (.dll) in the Nethermind's\xa0plugins\xa0directory and then run Nethermind. We will get to that soon."]}),"\n",(0,s.jsx)(n.p,{children:'Now, we have everything we need to begin with the actual implementation. For the sake of simplicity, we will create a basic plugin, a classic example, that simply prints the famous "Hello, world!" message.'}),"\n",(0,s.jsxs)(n.p,{children:["All Nethermind plugins must implement the ",(0,s.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Api/Extensions/INethermindPlugin.cs",children:(0,s.jsx)(n.code,{children:"INethermindPlugin"})})," interface. That's how Nethermind recognizes its plugins. So, let's create a ",(0,s.jsx)(n.code,{children:"DemoPlugin"})," class implementing that interface:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="DemoPlugin.cs" showLineNumbers',children:'using Nethermind.Api;\nusing Nethermind.Api.Extensions;\n\nnamespace DemoPlugin;\n\npublic class DemoPlugin : INethermindPlugin\n{\n    public string Name => "Demo plugin";\n    public string Description => "A sample plugin for demo";\n    public string Author => "Anonymous";\n\n    // The entry point of the plugin\n    public Task Init(INethermindApi nethermindApi)\n    {\n        var logger = nethermindApi.LogManager.GetClassLogger();\n        logger.Info("Hello, world!");\n\n        return Task.CompletedTask;\n    }\n\n    // Initializes the network stack\n    public Task InitNetworkProtocol() => Task.CompletedTask;\n    // Initializes the JSON-RPC stuff\n    public Task InitRpcModules() => Task.CompletedTask;\n    // Initializes the transaction-related stuff\n    public void InitTxTypesAndRlpDecoders(INethermindApi api) { }\n    // Cleans up resources\n    public ValueTask DisposeAsync() => ValueTask.CompletedTask;\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Let's examine the code above. The properties at lines 8-10 are required and self-explanatory. They are displayed on Nethermind startup for each loaded plugin. Next is the ",(0,s.jsx)(n.code,{children:"Init()"})," method at line 13, which is the main entry point of any plugin where initialization begins. Its only argument of type ",(0,s.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Api/INethermindApi.cs",children:(0,s.jsx)(n.code,{children:"INethermindApi"})})," \u2192 ",(0,s.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Api/IApiWithNetwork.cs",children:(0,s.jsx)(n.code,{children:"IApiWithNetwork"})})," \u2192 ",(0,s.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Api/IApiWithBlockchain.cs",children:(0,s.jsx)(n.code,{children:"IApiWithBlockchain"})})," \u2192 ",(0,s.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Api/IApiWithStores.cs",children:(0,s.jsx)(n.code,{children:"IApiWithStores"})})," \u2192 ",(0,s.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Api/IBasicApi.cs",children:(0,s.jsx)(n.code,{children:"IBasicApi"})})," is the main gateway to the Nethermind API, as its name implies. The ",(0,s.jsx)(n.code,{children:"INethermindApi"})," interface provides a rich functionality set essential for plugin development and is widely used in the Nethermind codebase."]}),"\n",(0,s.jsxs)(n.p,{children:["In line 15, we get the logger instance we need to print our message. Usually, that instance is stored in a private field to be available to other class members, but in our example, we don't need that. Once we have the instance, we log the message at the regular ",(0,s.jsx)(n.code,{children:"info"})," level."]}),"\n",(0,s.jsx)(n.p,{children:"The methods in lines 22-28 are irrelevant for this example, so they are left empty. We will get to them in later examples."}),"\n",(0,s.jsx)(n.p,{children:"To see our plugin in action, let's build it first:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dotnet build\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Once built, we need to copy the ",(0,s.jsx)(n.code,{children:"DemoPlugin.dll"})," to Nethermind's ",(0,s.jsx)(n.code,{children:"plugins"})," directory and run Nethermind. The output should be similar to the one below:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"24 Jan 18:01:37 | Nethermind is starting up\n...\n24 Jan 18:01:37 | Loading 14 assemblies from ...\n# highlight-start\n24 Jan 18:01:37 | Loading assembly DemoPlugin\n24 Jan 18:01:37 |   Found plugin type DemoPlugin\n# highlight-end\n24 Jan 18:01:37 | Loading assembly Nethermind.Api\n...\n24 Jan 18:01:39 | Initializing 17 plugins\n...\n24 Jan 18:01:39 |   EthStats by Nethermind\n24 Jan 18:01:39 |   EthStats by Nethermind initialized in 0ms\n# highlight-start\n24 Jan 18:01:39 |   Demo plugin by Anonymous\n24 Jan 18:01:39 | Hello, world!\n24 Jan 18:01:39 |   Demo plugin by Anonymous initialized in 0ms\n# highlight-end\n...\n"})}),"\n",(0,s.jsx)(n.p,{children:"That's it! We wrote our very first Nethermind plugin."}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.p,{children:"As Nethermind is highly configurable, so may its plugins. The same flexible configuration features that Nethermind uses internally are also available to its plugins. That means a plugin can be configured with command line options, environment variables, and configuration files by simply implementing a single interface."}),"\n",(0,s.jsx)(n.p,{children:"Nethermind loads and runs all the plugins it finds on startup. This behavior may be undesirable for resource-hungry plugins or incompatible with those requiring a specific network (chain) to run on. Thus, a typical scenario for almost any plugin is to be turned on or off by a configuration setting. Let's implement that feature for our Demo plugin."}),"\n",(0,s.jsxs)(n.p,{children:["All Nethermind configurations must implement the ",(0,s.jsx)(n.a,{href:"https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Config/IConfig.cs",children:(0,s.jsx)(n.code,{children:"IConfig"})})," interface. It's a 2 step process."]}),"\n",(0,s.jsxs)(n.p,{children:["First, we derive a new interface from the ",(0,s.jsx)(n.code,{children:"IConfig"})," and add all the required configuration options as properties. In our case, it's a single boolean property ",(0,s.jsx)(n.code,{children:"Enabled"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="IDemoConfig.cs" showLineNumbers',children:'using Nethermind.Config;\n\nnamespace DemoPlugin;\n\npublic interface IDemoConfig : IConfig\n{\n    // The attribute below is optional and serves as documentation\n    [ConfigItem(Description = "Whether to enable the Demo plugin.", DefaultValue = "false")]\n    bool Enabled { get; set; }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Second, we implement the interface above as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="DemoConfig.cs" showLineNumbers',children:"namespace DemoPlugin;\n\npublic class DemoConfig : IDemoConfig\n{\n    public bool Enabled { get; set; }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["That's it for the configuration. Now, let's check for the value of ",(0,s.jsx)(n.code,{children:"Enabled"})," in the ",(0,s.jsx)(n.code,{children:"Init()"})," method and only log the message if it's ",(0,s.jsx)(n.code,{children:"true"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'public Task Init(INethermindApi nethermindApi)\n{\n    var logger = nethermindApi.LogManager.GetClassLogger();\n    // highlight-start\n    var config = nethermindApi.Config<IDemoConfig>();\n    // highlight-end\n\n    if (config.Enabled)\n        logger.Info("Hello, world!");\n\n    return Task.CompletedTask;\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"The highlighted line shows how to get the configuration instance. Note that we get it by its interface type, not the implementing class. That's an important detail."}),"\n",(0,s.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,s.jsxs)(n.p,{children:["The configuration interface name must be in the ",(0,s.jsx)(n.code,{children:"I{PluginName}Config"})," format. In our case, it's ",(0,s.jsx)(n.code,{children:"IDemoConfig"}),". While the ",(0,s.jsx)(n.code,{children:"Config"})," suffix must remain as it is, the ",(0,s.jsx)(n.code,{children:"I"})," prefix can be any allowed symbol. However, following the .NET naming conventions is highly recommended, and so do we."]})}),"\n",(0,s.jsxs)(n.p,{children:["The naming convention is crucial for mapping the configuration options. For instance, ",(0,s.jsx)(n.code,{children:"IDemoConfig.Enabled"})," turns into the following configuration options:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--demo-enabled"})," or ",(0,s.jsx)(n.code,{children:"--Demo.Enabled"})," as a command line option"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"NETHERMIND_DEMOCONFIG_ENABLED"})," as an environment variable"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'{ "Demo": { "Enabled": true|false } }'})," as a JSON in a configuration file"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Since now we know what our configuration options are, let's build the project, copy the library to Nethermind's\xa0plugins\xa0directory, and run Nethermind as we did previously:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"24 Jan 18:01:37 | Nethermind is starting up\n...\n24 Jan 18:01:37 | Loading 14 assemblies from ...\n# highlight-start\n24 Jan 18:01:37 | Loading assembly DemoPlugin\n24 Jan 18:01:37 |   Found plugin type DemoPlugin\n# highlight-end\n24 Jan 18:01:37 | Loading assembly Nethermind.Api\n...\n24 Jan 18:01:39 | Initializing 17 plugins\n...\n24 Jan 18:01:39 |   EthStats by Nethermind\n24 Jan 18:01:39 |   EthStats by Nethermind initialized in 0ms\n# highlight-start\n24 Jan 18:01:39 |   Demo plugin by Anonymous\n24 Jan 18:01:39 |   Demo plugin by Anonymous initialized in 0ms\n# highlight-end\n...\n"})}),"\n",(0,s.jsxs)(n.p,{children:['There\'s a slight difference compared to the previous run -- the "Hello, world!" message is gone. The reason is that we put it under an ',(0,s.jsx)(n.code,{children:"if"})," condition which has not been entered because of the ",(0,s.jsx)(n.code,{children:"IDemoConfig.Enabled"})," is ",(0,s.jsx)(n.code,{children:"false"})," by default. Let's set it to ",(0,s.jsx)(n.code,{children:"true"})," using the command line option as follows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nethermind --demo-enabled true\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now we see that our message is back, and the configuration option works as intended! That is how to turn plugins on or off in Nethermind and provide other configuration options."}),"\n",(0,s.jsxs)(n.p,{children:["Last, let's test our plugin configuration documentation defined at line 8 in ",(0,s.jsx)(n.code,{children:"IDemoConfig.cs"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nethermind -h\n"})}),"\n",(0,s.jsx)(n.p,{children:"The output should be similar to the following:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"Description:\n\nUsage:\n  nethermind [options]\n\nOptions:\n  -?, -h, --help                                              Show help and usage information\n  --version                                                   Show version information\n...\n# highlight-start\n  --demo-enabled, --Demo.Enabled <value>                      Whether to enable the Demo plugin.\n# highlight-end\n  --era-exportdirectory, --Era.ExportDirectory <value>        Directory of archive export.\n  --era-from, --Era.From <value>                              Block number to import/export from.\n...\n"})}),"\n",(0,s.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TBD"})})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);