"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2686],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=d(n),m=r,k=c["".concat(s,".").concat(m)]||c[m]||u[m]||l;return n?a.createElement(k,o(o({ref:t},p),{},{components:n})):a.createElement(k,o({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:r,o[1]=i;for(var d=2;d<l;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2209:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const l={title:"Database",sidebar_position:5},o=void 0,i={unversionedId:"fundamentals/database",id:"fundamentals/database",title:"Database",description:"Nethermind uses the RocksDB database to store state. By default the database is stored in the",source:"@site/docs/fundamentals/database.md",sourceDirName:"fundamentals",slug:"/fundamentals/database",permalink:"/docs/fundamentals/database",draft:!1,editUrl:"https://github.com/NethermindEth/docs/tree/main/docs/docs/fundamentals/database.md",tags:[],version:"current",lastUpdatedAt:1695150460,formattedLastUpdatedAt:"Sep 19, 2023",sidebarPosition:5,frontMatter:{title:"Database",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Logs",permalink:"/docs/fundamentals/logs"},next:{title:"Pruning",permalink:"/docs/fundamentals/pruning"}},s={},d=[{value:"How to reduce database size",id:"how-to-reduce-database-size",level:2}],p={toc:d},c="wrapper";function u(e){let{components:t,...l}=e;return(0,r.kt)(c,(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Nethermind uses the ",(0,r.kt)("a",{parentName:"p",href:"https://rocksdb.org"},"RocksDB")," database to store state. By default the database is stored in the\nsame directory where the client binaries are. You can change it by providing a ",(0,r.kt)("inlineCode",{parentName:"p"},"--baseDbPath")," config switch in the\ncommand line, e.g.",(0,r.kt)("inlineCode",{parentName:"p"},"./Nethermind.Runner --config goerli --baseDbPath /home/username/nethermind_db")),(0,r.kt)("p",null,"After Nethermind is started, you will see multiple directories appearing in the ",(0,r.kt)("em",{parentName:"p"},"baseDbPath")," directory."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Example of the DB directory on a freshly deployed Ubuntu VM with Nethermind.",src:n(2788).Z,width:"825",height:"521"})),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"DB Directory"),(0,r.kt)("th",{parentName:"tr",align:null},"Content"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"blockInfos"),(0,r.kt)("td",{parentName:"tr",align:null},"information about blocks at each level of the block tree (canonical chain and branches)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"blocks"),(0,r.kt)("td",{parentName:"tr",align:null},"block bodies (block transactions and uncle data)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"bloom"),(0,r.kt)("td",{parentName:"tr",align:null},"bloom indexes for fast log searches")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"canonicalHashTrie"),(0,r.kt)("td",{parentName:"tr",align:null},"LES protocol related data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"code"),(0,r.kt)("td",{parentName:"tr",align:null},"contract bytecodes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"discoveryNodes"),(0,r.kt)("td",{parentName:"tr",align:null},"peers discovered via discovery protocol - used for quick peering after restarts (you can copy this DB between nodes to speed up peering)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"headers"),(0,r.kt)("td",{parentName:"tr",align:null},"block headers only")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"pendingTx"),(0,r.kt)("td",{parentName:"tr",align:null},"(this DB is wiped out on each restart) 2nd level cache of pending transactions / mempool (1st level is in memory)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"peers"),(0,r.kt)("td",{parentName:"tr",align:null},"stores additional sync peers information (like peer reputation) - you can copy this DB between nodes to speed up peering on fresh sync")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"receipts"),(0,r.kt)("td",{parentName:"tr",align:null},"transaction receipts data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"state"),(0,r.kt)("td",{parentName:"tr",align:null},"blockchain state including accounts and contract storage (Patricia trie nodes)")))),(0,r.kt)("p",null,"You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"rsync")," between your nodes to clone the database (One of our users copied entire 4.5TB archive state this\nway while the node was running and only stopped the node for the very last stage of ",(0,r.kt)("inlineCode",{parentName:"p"},"rsync")," ). You can also simply copy\nthe database between Unix and Windows systems (and most likely macOS)."),(0,r.kt)("h2",{id:"how-to-reduce-database-size"},"How to reduce database size"),(0,r.kt)("p",null,"The Nethermind database can experience substantial growth over time, starting from an initial size of approximately 650\nGB. As a result, many node-setups are configured to run on 1TB disks. However, even with the application of settings\ndesigned to slow the growth rate, these disks may eventually run out of free space."),(0,r.kt)("p",null,"Current options to reduce db size are:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"/docs/fundamentals/sync#resync-a-node-from-scratch"},"Re-sync database from scratch")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"/docs/fundamentals/pruning"},"Full pruning"))),(0,r.kt)("p",null,"The table below presents a short comparison of these methods including possible fine-tuning of each method. Data was\nfetched from a node running on a machine with the below specifications:\\\n\\\n",(0,r.kt)("strong",{parentName:"p"},"Node Version"),": 1.18.0\\\n",(0,r.kt)("strong",{parentName:"p"},"Consensus Client"),": Lighthouse\\\n",(0,r.kt)("strong",{parentName:"p"},"CPU"),": AMD EPYC 7713 64-Core Processor (16 cores allocated for this VM)\\\n",(0,r.kt)("strong",{parentName:"p"},"RAM"),": 64GB\\\n",(0,r.kt)("strong",{parentName:"p"},"Disk Size"),": 1.2 TB\\\n",(0,r.kt)("strong",{parentName:"p"},"IOPS of the disk","*"),": 70,000 - 80,000 IOPS (results vary in this range)"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Metric"),(0,r.kt)("th",{parentName:"tr",align:null},"Resync"),(0,r.kt)("th",{parentName:"tr",align:null},"Full Pruning"),(0,r.kt)("th",{parentName:"tr",align:null},"Full Pruning + Memory Budget (4 GB)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Time of execution")),(0,r.kt)("td",{parentName:"tr",align:null},"~4h"),(0,r.kt)("td",{parentName:"tr",align:null},"~24h"),(0,r.kt)("td",{parentName:"tr",align:null},"~12h")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Minimum free disk space")),(0,r.kt)("td",{parentName:"tr",align:null},"N/A - you can execute resync even if there is 0 free space (avoid such case)"),(0,r.kt)("td",{parentName:"tr",align:null},"250 GB"),(0,r.kt)("td",{parentName:"tr",align:null},"250 GB")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Attestation rate drop")),(0,r.kt)("td",{parentName:"tr",align:null},"100% - no attestation rewards during that time or highly reduced"),(0,r.kt)("td",{parentName:"tr",align:null},"5-10% during that time."),(0,r.kt)("td",{parentName:"tr",align:null},"TBC - not enough data yet")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Average block processing time of new blocks during process")),(0,r.kt)("td",{parentName:"tr",align:null},"N/A - new blocks are being processed after state but are significantly slower until OldBodies and OldReceipts are downloaded. Afterwards, average about 0.35s"),(0,r.kt)("td",{parentName:"tr",align:null},"0.7s"),(0,r.kt)("td",{parentName:"tr",align:null},"1.0s")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Is node online during process?")),(0,r.kt)("td",{parentName:"tr",align:null},"No - unless State is synced"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes - node follows chain and all modules are still enabled."),(0,r.kt)("td",{parentName:"tr",align:null},"Yes - node follows chain and all modules are still enabled.")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Command used for testing IOPS of disk:\\\n",(0,r.kt)("inlineCode",{parentName:"p"},"fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=4G --readwrite=randrw"))))}u.isMDXComponent=!0},2788:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image(61)-4a7650d3cb287d936f5e64433ff88fde.png"}}]);